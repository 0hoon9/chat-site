{"ast":null,"code":"import { addMessage } from '../store/messages.slice';\nimport { addUser, removeTypingUser, setOnlineUsers, setTypingUser } from '../store/users.slice';\nexport default function socketMiddleware(socket) {\n  return params => next => action => {\n    const {\n      dispatch\n    } = params;\n    const {\n      type,\n      payload\n    } = action;\n\n    switch (type) {\n      // 로그인시 Connect\n      case 'users/login':\n        {\n          socket.connect();\n          console.log('커넥트'); // Socket event handlers 등록\n          // 소켓에서 이벤트 발생되면 수신받아 리덕스 액션을 dispatch\n          // 로그인/아웃시 유저 리스트 업데이트\n\n          socket.on('users online', onlineUsers => {\n            console.log('유저 온라인');\n            dispatch(setOnlineUsers(onlineUsers));\n          }); // 새 메세지가 올 때마다 메시지 추가\n\n          socket.on('receive message', message => {\n            console.log('메세지 수신');\n            dispatch(addMessage(message));\n          }); // 유저가 입력을 중지하면 TypingUser 제거\n\n          socket.on('user stopped typing...', username => {\n            console.log('타이핑 중단');\n            dispatch(removeTypingUser(username));\n          }); // 유저 입력시 TypingUser 추가\n\n          socket.on('user starts typing...', username => {\n            console.log('타이핑 시작');\n            console.log('type: ', type);\n            dispatch(setTypingUser(username));\n          }); // 새 유저가 등록될 때 마다 User추가\n\n          socket.on('new user added', user => {\n            dispatch(addUser(user));\n          }); // 온라인 유저 목록에 현재 유저 추가\n\n          socket.emit('new login', payload);\n          break;\n        }\n      // 유저가 입력 중임을 서버에 알림\n\n      case 'users/sendThisUserIsTyping':\n        {\n          socket.emit('typing...', payload);\n          break;\n        }\n      // 유저가 입력을 중지했음을 서버에 알림\n\n      case 'users/sendThisUserStoppedTyping':\n        {\n          socket.emit('stopped typing...', payload);\n          return;\n        }\n      // 유저가 로그 아웃 할 때 소켓에서 연결 해제\n\n      case 'users/logout':\n        {\n          socket.disconnect();\n          break;\n        }\n      // 메세지 전송시 서버에 알림\n\n      case 'messages/sendMessage':\n        {\n          socket.emit('send message', payload);\n          return;\n        }\n    }\n\n    return next(action);\n  };\n}","map":{"version":3,"sources":["C:/node/chat-site/client/src/middleware/socketMiddleware.ts"],"names":["addMessage","addUser","removeTypingUser","setOnlineUsers","setTypingUser","socketMiddleware","socket","params","next","action","dispatch","type","payload","connect","console","log","on","onlineUsers","message","username","user","emit","disconnect"],"mappings":"AAEA,SAASA,UAAT,QAA2B,yBAA3B;AACA,SAASC,OAAT,EAAkBC,gBAAlB,EAAoCC,cAApC,EAAoDC,aAApD,QAAyE,sBAAzE;AAQA,eAAe,SAASC,gBAAT,CAA0BC,MAA1B,EAAuC;AACpD,SAAQC,MAAD,IAAqCC,IAAD,IAAgBC,MAAD,IAAiB;AACzE,UAAM;AAAEC,MAAAA;AAAF,QAAeH,MAArB;AACA,UAAM;AAAEI,MAAAA,IAAF;AAAQC,MAAAA;AAAR,QAAoBH,MAA1B;;AAEA,YAAQE,IAAR;AACE;AACA,WAAK,aAAL;AAAoB;AAClBL,UAAAA,MAAM,CAACO,OAAP;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAFkB,CAGlB;AACA;AAEA;;AACAT,UAAAA,MAAM,CAACU,EAAP,CAAU,cAAV,EAA2BC,WAAD,IAA2B;AACnDH,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAL,YAAAA,QAAQ,CAACP,cAAc,CAACc,WAAD,CAAf,CAAR;AACD,WAHD,EAPkB,CAYlB;;AACAX,UAAAA,MAAM,CAACU,EAAP,CAAU,iBAAV,EAA8BE,OAAD,IAAsB;AACjDJ,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAL,YAAAA,QAAQ,CAACV,UAAU,CAACkB,OAAD,CAAX,CAAR;AACD,WAHD,EAbkB,CAkBlB;;AACAZ,UAAAA,MAAM,CAACU,EAAP,CAAU,wBAAV,EAAqCG,QAAD,IAAsB;AACxDL,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAL,YAAAA,QAAQ,CAACR,gBAAgB,CAACiB,QAAD,CAAjB,CAAR;AACD,WAHD,EAnBkB,CAwBlB;;AACAb,UAAAA,MAAM,CAACU,EAAP,CAAU,uBAAV,EAAoCG,QAAD,IAAsB;AACvDL,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAD,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBJ,IAAtB;AACAD,YAAAA,QAAQ,CAACN,aAAa,CAACe,QAAD,CAAd,CAAR;AACD,WAJD,EAzBkB,CA+BlB;;AACAb,UAAAA,MAAM,CAACU,EAAP,CAAU,gBAAV,EAA6BI,IAAD,IAAgB;AAC1CV,YAAAA,QAAQ,CAACT,OAAO,CAACmB,IAAD,CAAR,CAAR;AACD,WAFD,EAhCkB,CAoClB;;AACAd,UAAAA,MAAM,CAACe,IAAP,CAAY,WAAZ,EAAyBT,OAAzB;AAEA;AACD;AAED;;AACA,WAAK,4BAAL;AAAmC;AACjCN,UAAAA,MAAM,CAACe,IAAP,CAAY,WAAZ,EAAyBT,OAAzB;AAEA;AACD;AAED;;AACA,WAAK,iCAAL;AAAwC;AACtCN,UAAAA,MAAM,CAACe,IAAP,CAAY,mBAAZ,EAAiCT,OAAjC;AAEA;AACD;AAED;;AACA,WAAK,cAAL;AAAqB;AACnBN,UAAAA,MAAM,CAACgB,UAAP;AACA;AACD;AACD;;AACA,WAAK,sBAAL;AAA6B;AAC3BhB,UAAAA,MAAM,CAACe,IAAP,CAAY,cAAZ,EAA4BT,OAA5B;AACA;AACD;AAnEH;;AAsEA,WAAOJ,IAAI,CAACC,MAAD,CAAX;AACD,GA3ED;AA4ED","sourcesContent":["import { Dispatch } from 'redux';\n\nimport { addMessage } from '../store/messages.slice';\nimport { addUser, removeTypingUser, setOnlineUsers, setTypingUser } from '../store/users.slice';\nimport { Message, User, RootState } from '../utilities/types';\n\ninterface SocketMiddlewareParams {\n  dispatch: Dispatch;\n  getState: () => RootState;\n}\n\nexport default function socketMiddleware(socket: any) {\n  return (params: SocketMiddlewareParams) => (next: any) => (action: any) => {\n    const { dispatch } = params;\n    const { type, payload } = action;\n\n    switch (type) {\n      // 로그인시 Connect\n      case 'users/login': {\n        socket.connect();\n        console.log('커넥트');\n        // Socket event handlers 등록\n        // 소켓에서 이벤트 발생되면 수신받아 리덕스 액션을 dispatch\n\n        // 로그인/아웃시 유저 리스트 업데이트\n        socket.on('users online', (onlineUsers: string[]) => {\n          console.log('유저 온라인');\n          dispatch(setOnlineUsers(onlineUsers));\n        });\n\n        // 새 메세지가 올 때마다 메시지 추가\n        socket.on('receive message', (message: Message) => {\n          console.log('메세지 수신');\n          dispatch(addMessage(message));\n        });\n\n        // 유저가 입력을 중지하면 TypingUser 제거\n        socket.on('user stopped typing...', (username: string) => {\n          console.log('타이핑 중단');\n          dispatch(removeTypingUser(username));\n        });\n\n        // 유저 입력시 TypingUser 추가\n        socket.on('user starts typing...', (username: string) => {\n          console.log('타이핑 시작');\n          console.log('type: ', type);\n          dispatch(setTypingUser(username));\n        });\n\n        // 새 유저가 등록될 때 마다 User추가\n        socket.on('new user added', (user: User) => {\n          dispatch(addUser(user));\n        });\n\n        // 온라인 유저 목록에 현재 유저 추가\n        socket.emit('new login', payload);\n\n        break;\n      }\n\n      // 유저가 입력 중임을 서버에 알림\n      case 'users/sendThisUserIsTyping': {\n        socket.emit('typing...', payload);\n\n        break;\n      }\n\n      // 유저가 입력을 중지했음을 서버에 알림\n      case 'users/sendThisUserStoppedTyping': {\n        socket.emit('stopped typing...', payload);\n\n        return;\n      }\n\n      // 유저가 로그 아웃 할 때 소켓에서 연결 해제\n      case 'users/logout': {\n        socket.disconnect();\n        break;\n      }\n      // 메세지 전송시 서버에 알림\n      case 'messages/sendMessage': {\n        socket.emit('send message', payload);\n        return;\n      }\n    }\n\n    return next(action);\n  };\n}\n"]},"metadata":{},"sourceType":"module"}